<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Capybara Hunt</title>
  <link rel="icon" type="image/png" href="samples/Cappa@3x.png">
  <link rel="stylesheet" href="css/hunt.css">
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.152.2/build/three.module.js"
    }
  }
  </script>
  <script src="js/i18n.js"></script>
  <script type="module" src="js/viewer.js"></script>
  <!-- Firebase SDK (Compat version for non-module use) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <!-- Header Controls Bar -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap;">
        <!-- Language Toggle -->
        <div style="display:flex;gap:6px;">
          <button id="lang-en" class="lang-btn lang-btn-active" data-lang="en">EN</button>
          <button id="lang-fr" class="lang-btn" data-lang="fr">FR</button>
        </div>
        <!-- Admin Button -->
        <button id="admin-unlock-btn" class="btn-admin" style="padding:8px 16px;border:none;background:#666;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;font-size:12px" data-i18n="unlock">Unlock</button>
      </div>
      
      <!-- Header Image with Red Background Bar -->
      <div class="header-bar">
        <img src="samples/Cappa+WithAsterisk@3x.png" alt="Capybara" class="header-image" />
      </div>
      
      <!-- Subheader Text -->
      <div class="subheader">
        <p data-i18n="intro1">Hidden inside the school, there are 50 tiny capybaras. Your goal is to find the most amount of them.</p>
        <p data-i18n="intro2">When you find one, enter its code into this website's code box below.</p>
        
        <h2 data-i18n="rulesTitle">Rules:</h2>
        <ul>
          <li data-i18n="rule1">Objects do not need to be broken to find a Capy.</li>
          <li data-i18n="rule2">Capys are not inside of classrooms; do not disturb them.</li>
          <li data-i18n="rule3">Moving of Capys or their code will get you eliminated.</li>
          <li data-i18n="rule4">A Capy's code cannot be entered more than once per player.</li>
          <li data-i18n="rule5">You can work together in teams.</li>
        </ul>
        
        <p><strong data-i18n="scoringTitle">Scoring:</strong><br>
        <span data-i18n="scoring1">Each capybara is worth 1 point at first scan; after that, its worth drops to 0.5.</span></p>
        
        <p data-i18n="scoring2">Out of the 50, there is a golden one worth 10 points, but after being scanned, its worth drops to 1.</p>
        
        <p data-i18n="scoring3">Once all Capys are found or it reaches the 20th, the event is over.</p>
        
        <p style="text-align:center;font-weight:bold;margin-top:16px" data-i18n="happyHunting">Happy Hunting. üíï</p>
      </div>

      <!-- Rebel Capybara Section -->
      <div class="rebel-section">
        <h2 style="margin-top:0">Rogue Capybaras</h2>
        <p><strong>10 Rogue Capybara's have snuck into CJS staff's desks and have promised them points to stay hidden. It's your job to expose them.</strong></p>
        <p><strong>How to Find Them:</strong> Using the hints below you must identify which staff members are secretly hiding a Rogue Capybara and say the codeword associated with those hints to get them to reveal it to earn points.</p>
        
        <h3 style="margin-top:16px">Scoring:</h3>
        <ul>
          <li>5 points on the first scan</li>
          <li>2.5 points for the next 2 scans</li>
          <li>1 point for the next 3 scans</li>
          <li>Then it drops to zero.</li>
        </ul>
        
        <h3 style="margin-top:16px">Rules & Details:</h3>
        <ul>
          <li>Do not intrude in ongoing classes - only visit during spare, lunch or after class.</li>
          <li>Do not guess random codewords to teachers - teachers will not respond, even if you accidentally say a correct one.</li>
          <li>Follow all the previous game rules and be respectful.</li>
          <li>Today (Feb 19) there will be 5 Rogue Capybaras to be found the other half will be out tomorrow.</li>
          <li>Two hints will be available in the morning and three during lunch.</li>
          <li>If there are any errors on the website or questions, message James Hohner on Teams.</li>
        </ul>
      </div>
      
      <div id="count-display">
        <div class="big-number">50</div>
        <div class="label" data-i18n="remaining">remaining</div>
      </div>
    </header>

    <main>
      <!-- 3D Viewer with HUD Overlays -->
      <div style="position:relative;margin-bottom:24px;display:inline-block;width:100%">
        <div id="stl-viewer" class="viewer-box"></div>
        
        <!-- HUD Widget: About -->
        <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);color:#fff;padding:12px;border-radius:8px;font-size:11px;width:160px;z-index:10">
          <div style="font-weight:bold;margin-bottom:6px" data-i18n="about">About</div>
          <div style="line-height:1.3;opacity:0.9" data-i18n="aboutText">
            ‚Üê This is what you're looking for! 
          </div>
        </div>
      </div>

      <!-- Admin Modal (for leaderboard management) -->
      <div id="admin-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:450px;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 20px 0;font-size:20px">Admin Panel</h2>
          
          <!-- Print Button -->
          <div style="margin-bottom:20px;">
            <button id="admin-print-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Print Codes</button>
          </div>

          <!-- Remove Names Checklist -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Manage Entries (uncheck to hide)</h3>
            <div id="admin-names-checklist" style="max-height:200px;overflow-y:auto;border:1px solid #eee;padding:8px;border-radius:4px;"></div>
          </div>

          <!-- Rebel Codes Section -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Rogue Capybara Codes</h3>
            <button id="admin-print-rebel-codes-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;margin-bottom:8px">Print Rogue Codes</button>
            <button id="admin-generate-rebel-codes" class="btn-primary" style="width:100%;padding:12px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;margin-bottom:8px">Generate/Show Rogue Codes</button>
            <div id="admin-rebel-codes-display" style="max-height:200px;overflow-y:auto;border:1px solid #eee;padding:8px;border-radius:4px;font-family:monospace;font-size:12px;background:#f5f5f5;line-height:1.6"></div>
          </div>

          <!-- Hints Visibility Section -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Teacher Hints Visibility (check to show)</h3>
            <div id="admin-hints-visibility-checklist" style="max-height:150px;overflow-y:auto;border:1px solid #eee;padding:8px;border-radius:4px;"></div>
          </div>

          <!-- Reset Individual Rebel Scans Section -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Reset Individual Rogue Scans</h3>
            <div id="admin-rebel-scans-list" style="max-height:200px;overflow-y:auto;border:1px solid #eee;padding:8px;border-radius:4px;font-size:12px"></div>
          </div>

          <!-- Remove Hints Button -->
          <div style="margin-bottom:20px;">
            <button id="admin-remove-hints-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#ff9800;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Remove Hints (Edit Mode)</button>
          </div>

          <!-- Add Admin Hint -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Add Admin Hint</h3>
            <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center;">
              <label for="admin-hint-capy" style="font-size:13px;">Capybara #</label>
              <select id="admin-hint-capy" style="flex:1;padding:6px 8px;border-radius:4px;border:1px solid #ccc;"></select>
            </div>
            <textarea id="admin-hint-text" placeholder="Enter admin hint here..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:8px;box-sizing:border-box;min-height:60px;font-family:inherit;resize:vertical;"></textarea>
            <div id="admin-hint-error" style="color:#d62828;font-size:12px;margin-bottom:8px;display:none"></div>
            <button id="admin-hint-submit" class="btn-primary" style="width:100%;padding:10px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Add Admin Hint</button>
          </div>
          <!-- Reset All Button -->
          <div style="margin-bottom:0;">
            <button id="admin-reset-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#f44336;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Reset All</button>
          </div>

          <button id="admin-modal-close" class="btn-primary" style="width:100%;padding:10px;border:none;background:#999;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;margin-top:16px" data-i18n="submit">Close</button>
        </div>
      </div>

      <!-- Password Modal -->
      <div id="password-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:300px;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 16px 0;font-size:20px" data-i18n="adminPassword">Admin Password</h2>
          <input id="admin-password" type="password" data-i18n-placeholder="enterPassword" placeholder="Enter password" autocomplete="off" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:16px;box-sizing:border-box" />
          <div style="display:flex;gap:8px">
            <button id="modal-submit" class="btn-primary" style="flex:1" data-i18n="submit">Unlock</button>
            <button id="modal-cancel" class="btn-secondary" style="flex:1;background:#999" data-i18n="cancel">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Hint Modal for User Submitted Hints -->
      <div id="hint-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:2000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:350px;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 16px 0;font-size:20px">Leave a Hint</h2>
          <p style="margin:0 0 12px 0;font-size:12px;color:#666"><span id="hint-capybara-info"></span> - Help others find this capybara!</p>
          <textarea id="hint-text" placeholder="Enter your hint here..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:12px;box-sizing:border-box;min-height:100px;font-family:inherit;resize:vertical;"></textarea>
          <div id="hint-error" style="color:#d62828;font-size:12px;margin-bottom:12px;display:none"></div>
          <div style="display:flex;gap:8px">
            <button id="hint-submit" class="btn-primary" style="flex:1;padding:10px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Submit Hint</button>
            <button id="hint-cancel" style="flex:1;padding:10px;border:none;background:#999;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Skip</button>
          </div>
        </div>
      </div>

      <!-- Hint Modal for Teachers -->
      <div id="teacher-hint-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:2000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:400px;box-shadow:0 10px 40px rgba(0,0,0,0.3);max-height:80vh;overflow-y:auto">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
            <h2 id="teacher-hint-title" style="margin:0;font-size:20px"></h2>
            <button id="teacher-hint-close" style="background:none;border:none;font-size:24px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center">‚úï</button>
          </div>
          <div id="teacher-hint-content" style="font-size:14px;line-height:1.6;color:#555"></div>
          <div id="teacher-hint-codeword" style="margin-top:16px;padding:12px;background:#f5f5f5;border-radius:6px;border-left:4px solid #d62828;font-weight:bold;color:#d62828"></div>
        </div>
      </div>

      <!-- Scan Section (Home) -->
      <section class="section">
        <h2 data-i18n="enterCode">Enter Code</h2>
        <div style="display:flex;gap:8px;margin-bottom:24px">
          <input id="code-input" type="text" data-i18n-placeholder="codePlaceholder" placeholder="e.g., CP-1A2B" />
          <button id="add-code" class="btn-primary" data-i18n="add">Add</button>
        </div>
      </section>

      <!-- Rebel Capybara Code Section -->
      <section class="section">
        <h2>Rogue Capybara Codes</h2>
        <p style="font-size:13px;color:#666;margin-bottom:12px"><strong>How it works:</strong> Enter the Rogue Capybara code you were given by a teacher down below.</p>
        <div style="display:flex;gap:8px;margin-bottom:24px">
          <input id="rebel-code-input" type="text" placeholder="e.g., ROGUE-1234" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:0" />
          <button id="add-rebel-code" class="btn-primary" style="padding:12px 20px">Submit</button>
        </div>
        <div id="rebel-codes-found" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px">
          <!-- Rebel codes will be rendered here -->
        </div>
      </section>

      <!-- Rebel Capybara Hints Section -->
      <section class="section">
        <h2>Teacher Hints</h2>
        <p style="font-size:13px;color:#666;margin-bottom:16px">Click on a teacher to see their hints and learn their codeword:</p>
        <div id="hints-buttons-container" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px">
          <!-- Hint buttons will be rendered here -->
        </div>
      </section>

      <!-- Leaderboard -->
      <section class="section">
        <h2 data-i18n="leaderboard">Leaderboard</h2>
        <div id="leaderboard" class="leaderboard"></div>
      </section>

      <!-- Hints Section -->
      <section class="section">
        <h2 data-i18n="hintsSection">Hints</h2>
        <div id="hints-container" style="max-height:400px;overflow-y:auto;"></div>
      </section>
    </main>
  </div>

  <script src="js/hunt.js"></script>
</body>
</html>
