<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Capybara Hunt</title>
  <link rel="icon" type="image/png" href="samples/Cappa@3x.png">
  <link rel="stylesheet" href="css/hunt.css">
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.152.2/build/three.module.js"
    }
  }
  </script>
  <script src="js/i18n.js"></script>
  <script type="module" src="js/viewer.js"></script>
  <!-- Firebase SDK (Compat version for non-module use) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <!-- Header Controls Bar -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap;">
        <!-- Language Toggle -->
        <div style="display:flex;gap:6px;">
          <button id="lang-en" class="lang-btn lang-btn-active" data-lang="en">EN</button>
          <button id="lang-fr" class="lang-btn" data-lang="fr">FR</button>
        </div>
        <!-- Admin Button -->
        <button id="admin-unlock-btn" class="btn-admin" style="padding:8px 16px;border:none;background:#666;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;font-size:12px" data-i18n="unlock">Unlock</button>
      </div>
      
      <!-- Header Image with Red Background Bar -->
      <div class="header-bar">
        <img src="samples/Cappa+WithAsterisk@3x.png" alt="Capybara" class="header-image" />
      </div>
      
      <!-- Subheader Text -->
      <div class="subheader">
        <p data-i18n="intro1">Hidden inside the school, there are 50 tiny capybaras. Your goal is to find the most amount of them.</p>
        <p data-i18n="intro2">When you find one, enter its code into this website's code box below.</p>
        
        <h2 data-i18n="rulesTitle">Rules:</h2>
        <ul>
          <li data-i18n="rule1">Objects do not need to be broken to find a Capy.</li>
          <li data-i18n="rule2">Capys are not inside of classrooms; do not disturb them.</li>
          <li data-i18n="rule3">Moving of Capys or their code will get you eliminated.</li>
          <li data-i18n="rule4">A Capy's code cannot be entered more than once per player.</li>
          <li data-i18n="rule5">You can work together in teams.</li>
        </ul>
        
        <p><strong data-i18n="scoringTitle">Scoring:</strong><br>
        <span data-i18n="scoring1">Each capybara is worth 1 point at first scan; after that, its worth drops to 0.5.</span></p>
        
        <p data-i18n="scoring2">Out of the 100, there is a golden one worth 10 points, but after being scanned, its worth drops to 1.</p>
        
        <p data-i18n="scoring3">Once all Capys are found or it reaches the 20th, the event is over.</p>
        
        <p style="text-align:center;font-weight:bold;margin-top:16px" data-i18n="happyHunting">Happy Hunting. üíï</p>
      </div>
      
      <div id="count-display">
        <div class="big-number">100</div>
        <div class="label" data-i18n="remaining">remaining</div>
      </div>
    </header>

    <main>
      <!-- 3D Viewer with HUD Overlays -->
      <div style="position:relative;margin-bottom:24px;display:inline-block;width:100%">
        <div id="stl-viewer" class="viewer-box"></div>
        
        <!-- HUD Widget: About -->
        <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);color:#fff;padding:12px;border-radius:8px;font-size:11px;width:160px;z-index:10">
          <div style="font-weight:bold;margin-bottom:6px" data-i18n="about">About</div>
          <div style="line-height:1.3;opacity:0.9" data-i18n="aboutText">
            ‚Üê This is what you're looking for! 
          </div>
        </div>
      </div>

      <!-- Admin Modal (for leaderboard management) -->
      <div id="admin-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:450px;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 20px 0;font-size:20px">Admin Panel</h2>
          
          <!-- Print Button -->
          <div style="margin-bottom:20px;">
            <button id="admin-print-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Print Codes</button>
          </div>

          <!-- Remove Names Checklist -->
          <div style="margin-bottom:20px;border-top:1px solid #ddd;padding-top:16px;">
            <h3 style="margin:0 0 12px 0;font-size:14px;font-weight:bold">Manage Entries (uncheck to hide)</h3>
            <div id="admin-names-checklist" style="max-height:200px;overflow-y:auto;border:1px solid #eee;padding:8px;border-radius:4px;"></div>
          </div>

          <!-- Remove Hints Button -->
          <div style="margin-bottom:20px;">
            <button id="admin-remove-hints-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#ff9800;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Remove Hints (Edit Mode)</button>
          </div>

          <!-- Reset All Button -->
          <div style="margin-bottom:0;">
            <button id="admin-reset-btn" class="btn-primary" style="width:100%;padding:12px;border:none;background:#f44336;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Reset All</button>
          </div>

          <button id="admin-modal-close" class="btn-primary" style="width:100%;padding:10px;border:none;background:#999;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;margin-top:16px" data-i18n="submit">Close</button>
        </div>
      </div>

      <!-- Password Modal -->
      <div id="password-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:1000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:300px;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 16px 0;font-size:20px" data-i18n="adminPassword">Admin Password</h2>
          <input id="admin-password" type="password" data-i18n-placeholder="enterPassword" placeholder="Enter password" autocomplete="off" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:16px;box-sizing:border-box" />
          <div style="display:flex;gap:8px">
            <button id="modal-submit" class="btn-primary" style="flex:1" data-i18n="submit">Unlock</button>
            <button id="modal-cancel" class="btn-secondary" style="flex:1;background:#999" data-i18n="cancel">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Hint Modal -->
      <div id="hint-modal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:2000;display:none">
        <div style="background:#fff;padding:32px;border-radius:12px;max-width:350px;box-shadow:0 10px 40px rgba(0,0,0,0.3)">
          <h2 style="margin:0 0 16px 0;font-size:20px">Leave a Hint</h2>
          <p style="margin:0 0 12px 0;font-size:12px;color:#666"><span id="hint-capybara-info"></span> - Help others find this capybara!</p>
          <textarea id="hint-text" placeholder="Enter your hint here..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:12px;box-sizing:border-box;min-height:100px;font-family:inherit;resize:vertical;"></textarea>
          <div id="hint-error" style="color:#d62828;font-size:12px;margin-bottom:12px;display:none"></div>
          <div style="display:flex;gap:8px">
            <button id="hint-submit" class="btn-primary" style="flex:1;padding:10px;border:none;background:#d62828;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Submit Hint</button>
            <button id="hint-cancel" style="flex:1;padding:10px;border:none;background:#999;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold">Skip</button>
          </div>
        </div>
      </div>

      <!-- Scan Section (Home) -->
      <section class="section">
        <h2 data-i18n="enterCode">Enter Code</h2>
        <div style="display:flex;gap:8px;margin-bottom:24px">
          <input id="code-input" type="text" data-i18n-placeholder="codePlaceholder" placeholder="e.g., CP-1A2B" />
          <button id="add-code" class="btn-primary" data-i18n="add">Add</button>
        </div>
      </section>

      <!-- Leaderboard -->
      <section class="section">
        <h2 data-i18n="leaderboard">Leaderboard</h2>
        <div id="leaderboard" class="leaderboard"></div>
      </section>

      <!-- Hints Section -->
      <section class="section">
        <h2>Hints</h2>
        <div id="hints-container" style="max-height:400px;overflow-y:auto;"></div>
      </section>
    </main>
  </div>

  <script src="js/hunt.js"></script>
</body>
</html>
